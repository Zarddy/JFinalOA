	
	<div id="page-content">
			<div class="col-lg-12">
		        <div class="panel">
		            <div class="panel-heading">
		                <h3 class="panel-title" style="text-align: right;">
		                	#@installPJaxGoBackBtn()
		                	添加新用户
		                </h3>
		            </div>
		            <form id="editForm" class="panel-body form-horizontal form-padding">
		            	<div class="form-group">
		                    <label class="col-md-3 control-label">所属单位</label>
		                    <div class="col-md-5">
		                    	<div class="input-group mar-btm">
			                        <input type="text" id="orgname" class="form-control" disabled value="#(org?org.name:'')">
			                        <input type="hidden"  name="sysUser.id" class="form-control" value="#(o?o.id:'')">
		                    	</div>
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-3 control-label">用户登录名</label>
		                    <div class="col-md-9">
		                        <input type="text" disabled class="form-control"  value="#(o?o.username:'')">
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-3 control-label">密码</label>
		                    <div class="col-md-9">
		                        <input type="password"  name="sysUser.password" class="form-control"  value="" #if(o) placeholder="如果您不想修改密码,请将此项留空!" #end >
		                        <small class="help-block">请输入密码</small>
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-3 control-label">密码确认</label>
		                    <div class="col-md-9">
		                        <input type="password"  name="password2" class="form-control"  value="" #if(o) placeholder="如果您不想修改密码,请将此项留空!" #end>
		                        <small class="help-block">请再次输入密码</small>
		                    </div>
		                </div>
		                <div class="form-group">
	                    	<label class="col-md-3 control-label">移动电话</label>
	                        <div class="col-md-9">
		                           <input type="text"  name="sysUser.mobile" class="form-control"  value="#(o?o.mobile:'')">
		                        <small class="help-block">请输入移动电话</small>
		                    </div>
	                    </div>
		                <div class="form-group">
		                    <label class="col-md-3 control-label">用户姓名</label>
		                    <div class="col-md-9">
		                        <input type="text" disabled class="form-control"  value="#(o?o.name:'')">
		                        <small class="help-block">请输入用户姓名</small>
		                    </div>
		                </div>
		                <div class="form-group">
	                    	<label class="col-md-3 control-label">性别</label>
                            <div class="col-md-9">
		                           <input id="sysUserSexMan" disabled name="sex" class="magic-radio" type="radio" value="1" #if(o&&o.sex=="1") checked #end>
		                           <label for="sysUserSexMan">男</label>
		                           <input id="sysUserSexWoman" disabled name="sex" class="magic-radio" type="radio" value="0" #if(o&&o.sex=="0") checked #end>
		                           <label for="sysUserSexWoman">女</label>
		                    </div>
                        </div>
                        <div class="form-group">
	                    	<label class="col-md-3 control-label">邮箱地址</label>
                            <div class="col-md-9">
		                           <input type="text" disabled class="form-control"  value="#(o?o.email:'')">
		                        <small class="help-block">请输入邮箱地址</small>
		                    </div>
                        </div>
                        <div class="form-group">
	                    	<label class="col-md-3 control-label">身份证号</label>
                            <div class="col-md-9">
		                           <input type="text" disabled class="form-control"  value="#(o?o.idcard:'')">
		                        <small class="help-block">请输入身份证号</small>
		                    </div>
                        </div>
                        <div class="form-group">
	                    	<label class="col-md-3 control-label">拥有角色</label>
	                        <div class="col-md-9">
	                            <input type="text" id="userRoleName" class="form-control" readonly value="#(userRoleName)">
		                        <input type="hidden" id="userRoleId" name="userRoleId" class="form-control" value="#(userRoleId)">
		                    </div>
	                    </div>
                        <div class="form-group">
	                    	<label class="col-md-3 control-label">用户类型</label>
                            <div class="col-md-9">
		                           <input id="sysUserTypeText" class="magic-radio" type="radio" name="type" value="0" #if(o&&o.type=="0") checked #end disabled>
		                           <label for="sysUserTypeText">试用</label>
		                           <input id="sysUserTypeReal" class="magic-radio" type="radio" name="type" value="1" #if(o&&o.type=="1") checked #end disabled>
		                           <label for="sysUserTypeReal">正式员工</label>
		                           <input id="sysUserTypeLeave" class="magic-radio" type="radio" name="type" value="2" #if(o&&o.type=="2") checked #end disabled>
		                           <label for="sysUserTypeLeave">离职</label>
		                           <input id="sysUserTypeStudy" class="magic-radio" type="radio" name="type" value="3" #if(o&&o.type=="3") checked #end disabled>
		                           <label for="sysUserTypeStudy">实习</label>
		                    </div>
                        </div>
		                <div class="panel-footer">
		                    <div class="row">
		                        <div class="col-sm-9 col-sm-offset-3">
		                            <button class="btn btn-warning" type="reset">重置</button>
		                            <button class="btn btn-primary" type="submit" >保存</button>
		                        </div>
		                    </div>
		                </div>
		            </form>
		        </div>
		    </div>
	</div>
	<script>
		var ifEdit = "#(o?'1':'0')";//是否是修改页面
		var validPassword = {};//密码1
		var validPassword2 = {};//密码2
		var validUsername = {};//用户名 唯一性校验
		if(ifEdit=='1'){//如果是修改 , 密码可以为空
			validPassword = {
                stringLength: {
                    max: 15,
                    message: '*密码长度必须小于15'
                }
            };
			validPassword2 = {
                stringLength: {
                    max: 15,
                    message: '*确认密码长度必须小于15'
                },
                identical: {
                	field: 'sysUser.password',
                	message: '*两次输入密码不一致'
                }
            };
			validUsername = {
                notEmpty: {
                    message: '*登录名不能为空'
                },
                stringLength: {
                    max: 15,
                    message: '*登录名长度必须小于15'
                },
                regexp: {
                	regexp: /^[a-zA-Z0-9_]+$/,
                    message: '用户名只能包含大写、小写、数字和下划线'
                }
            }
		}else{//新增的
				validPassword = {
	                notEmpty: {
	                    message: '*密码不能为空'
	                },
	                stringLength: {
	                    max: 15,
	                    message: '*密码长度必须小于15'
	                }
	            }
				
				validPassword2 = {
	                notEmpty: {
	                    message: '密码不能为空'
	                },
	                stringLength: {
	                    max: 15,
	                    message: '*确认密码长度必须小于15'
	                },
	                identical: {
	                	field: 'sysUser.password',
	                	message: '*两次输入密码不一致'
	                }
	            }
				validUsername = {
	                notEmpty: {
	                    message: '*用户名不能为空'
	                },
	                stringLength: {
	                    max: 15,
	                    message: '*用户名长度必须小于15'
	                },
	                remote: {
	                    message: '*用户名已被注册',
	                    url:ctx+'/admin/sys/user/validUsername',
	                    delay:1000
	                },
	                regexp: {
	                	regexp: /^[a-zA-Z0-9_]+$/,
	                    message: '用户名只能包含英文大写/小写、数字和下划线'
	                }
		        }
		}
		function selectOneOrg(){
			//调用选择一个单位组件
			pointLion.selectOneOrg(function(orgNode){
				var thisId = $("#orgId").val();//主键
				$("#orgname").val(orgNode.name);//所选单位名称
				$("#orgid").val(orgNode.id);//所选单位id
			},null,null,null,null);
		}
		function save(){
			var data = common_ajax.ajaxFunc("/admin/sys/user/save", $('#editForm').serialize(), "json", null);
			if(data.success){
				pointLion.alertMsg("保存成功!" , "success" , "small" , null);
			}
		}
		$(document).ready(function() {
		    $('#editForm').bootstrapValidator({
		    		excluded:[":hidden"],//关键配置，表示只对于隐藏域不进行验证，其他的表单元素都要验证
		            fields: {
		            	"sysUser.orgName":{
		            		validators: {
				                notEmpty: {
				                    message: '*所属单位不能为空'
				                }
				            }
		            	},
		            	"sysUser.username": {
						    validators: validUsername
		                },
		                "sysUser.password": {
						    validators: validPassword
		                },
		                "password2": {
						    validators: validPassword2
		                },
		                "sysUser.name": {
						    validators: {
				                notEmpty: {
				                    message: '*用户姓名不能为空'
				                },
				                stringLength: {
				                    max: 15,
				                    message: '*确认密码长度必须小于15'
				                }
				            }
		                },
		                "sysUser.mobile": {
						    validators: {
						    	regexp: {
									regexp: /^1(3|4|5|7|8)\d{9}$/,
									message: '*移动电话格式不对'
								}
				            }
		                },
		                "sysUser.email": {
						    validators: {
						    	regexp: {
									regexp: /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/ ,
									message: '*邮箱格式不对'
								},
								stringLength: {
				                    max: 100,
				                    message: '*您的邮箱地址也太长了吧'
				                }
				            }
		                },
		                "sysUser.idcard": {
						    validators: {
						    	regexp: {
									regexp: /^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/ ,
									message: '*身份证号格式不对'
								}
				            }
		                }
		            }
		        }).on("success.form.bv", function (e) {
		            save();
		            return false;//阻止表单跳转
		        });
		});
	</script>